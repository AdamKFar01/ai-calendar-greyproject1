<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Calendar</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 20px;
            height: calc(100vh - 40px);
        }

        .calendar-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
        }

        .chat-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .month-year {
            font-size: 28px;
            font-weight: 600;
            color: #333;
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
        }

        .nav-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 8px 12px;
            cursor: pointer;
            font-size: 14px;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            flex: 1;
        }

        .day-header {
            text-align: center;
            font-weight: 600;
            color: #666;
            padding: 10px;
            font-size: 14px;
        }

        .day-cell {
            background: white;
            border: 2px solid #f0f0f0;
            border-radius: 12px;
            padding: 8px;
            min-height: 100px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .day-cell:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
        }

        .day-number {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .other-month .day-number {
            color: #ccc;
        }

        .today {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            border: none;
        }

        .today .day-number {
            color: white;
        }

        .event {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 2px 6px;
            border-radius: 6px;
            font-size: 11px;
            margin: 2px 0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .event:hover {
            transform: scale(1.05);
        }

        .chat-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            font-size: 18px;
            font-weight: 600;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: #f9f9f9;
        }

        .message {
            margin-bottom: 15px;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .user-message {
            text-align: right;
        }

        .user-message .bubble {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            display: inline-block;
            padding: 10px 15px;
            border-radius: 18px 18px 4px 18px;
            max-width: 80%;
        }

        .ai-message .bubble {
            background: white;
            color: #333;
            display: inline-block;
            padding: 10px 15px;
            border-radius: 18px 18px 18px 4px;
            max-width: 80%;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .chat-input-container {
            padding: 20px;
            background: white;
            border-top: 1px solid #eee;
        }

        .chat-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #f0f0f0;
            border-radius: 25px;
            font-size: 14px;
            outline: none;
            transition: border-color 0.3s;
        }

        .chat-input:focus {
            border-color: #667eea;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            animation: modalSlide 0.3s ease;
        }

        @keyframes modalSlide {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 24px;
            font-weight: 600;
            color: #333;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999;
            transition: color 0.3s;
        }

        .close-btn:hover {
            color: #333;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            color: #666;
            font-weight: 500;
        }

        .form-input {
            width: 100%;
            padding: 10px 15px;
            border: 2px solid #f0f0f0;
            border-radius: 10px;
            font-size: 14px;
            outline: none;
            transition: border-color 0.3s;
        }

        .form-input:focus {
            border-color: #667eea;
        }

        .form-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #666;
        }

        .btn-danger {
            background: linear-gradient(135deg, #f093fb, #f5576c);
            color: white;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(240, 147, 251, 0.4);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="calendar-section">
            <div class="calendar-header">
                <h1 class="month-year" id="monthYear"></h1>
                <div class="nav-buttons">
                    <button class="nav-btn" onclick="previousMonth()">← Previous</button>
                    <button class="nav-btn" onclick="currentMonth()">Today</button>
                    <button class="nav-btn" onclick="nextMonth()">Next →</button>
                </div>
            </div>
            <div class="calendar-grid" id="calendar"></div>
        </div>

        <div class="chat-section">
            <div class="chat-header">
                AI Calendar Assistant
            </div>
            <div class="chat-messages" id="chatMessages">
                <div class="message ai-message">
                    <div class="bubble">
                        Hi! I can help you manage your calendar. Try saying things like:<br><br>
                        • "Sept 10 2025 I have a BAE virtual event from 15 to 16:30"<br>
                        • "Add meeting tomorrow at 2pm"<br>
                        • "Schedule lunch with John next Friday at noon"<br><br>
                        You can also click on any day to manually add events!
                    </div>
                </div>
            </div>
            <div class="chat-input-container">
                <input type="text" class="chat-input" id="chatInput" placeholder="Type your message..." onkeypress="handleChatKeyPress(event)">
            </div>
        </div>
    </div>

    <div class="modal" id="eventModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">Add Event</h2>
                <button class="close-btn" onclick="closeModal()">×</button>
            </div>
            <div class="form-group">
                <label class="form-label">Event Title</label>
                <input type="text" class="form-input" id="eventTitle" placeholder="Enter event title">
            </div>
            <div class="form-group">
                <label class="form-label">Date</label>
                <input type="date" class="form-input" id="eventDate">
            </div>
            <div class="form-group">
                <label class="form-label">Start Time</label>
                <input type="time" class="form-input" id="eventStartTime">
            </div>
            <div class="form-group">
                <label class="form-label">End Time</label>
                <input type="time" class="form-input" id="eventEndTime">
            </div>
            <div class="form-buttons">
                <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                <button class="btn btn-danger" id="deleteBtn" onclick="deleteEvent()" style="display: none;">Delete</button>
                <button class="btn btn-primary" onclick="saveEvent()">Save</button>
            </div>
        </div>
    </div>

    <script>
        let currentDate = new Date();
        let events = [];
        let editingEventId = null;

        const months = ['January', 'February', 'March', 'April', 'May', 'June', 
                       'July', 'August', 'September', 'October', 'November', 'December'];
        const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];

        function init() {
            // Load events from localStorage
            const savedEvents = localStorage.getItem('calendarEvents');
            if (savedEvents) {
                events = JSON.parse(savedEvents);
            }
            renderCalendar();
        }

        function renderCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            document.getElementById('monthYear').textContent = `${months[month]} ${year}`;
            
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const prevMonthDays = new Date(year, month, 0).getDate();
            
            let html = '';
            
            // Day headers
            days.forEach(day => {
                html += `<div class="day-header">${day}</div>`;
            });
            
            // Previous month days
            for (let i = firstDay - 1; i >= 0; i--) {
                const day = prevMonthDays - i;
                const date = new Date(year, month - 1, day);
                html += createDayCell(date, true);
            }
            
            // Current month days
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month, day);
                html += createDayCell(date, false);
            }
            
            // Next month days
            const totalCells = firstDay + daysInMonth;
            const nextMonthDays = totalCells % 7 === 0 ? 0 : 7 - (totalCells % 7);
            for (let day = 1; day <= nextMonthDays; day++) {
                const date = new Date(year, month + 1, day);
                html += createDayCell(date, true);
            }
            
            document.getElementById('calendar').innerHTML = html;
        }

        function createDayCell(date, otherMonth) {
            const today = new Date();
            const isToday = date.toDateString() === today.toDateString();
            const dateStr = formatDateForComparison(date);
            const dayEvents = events.filter(e => e.date === dateStr);
            
            let cellClass = 'day-cell';
            if (otherMonth) cellClass += ' other-month';
            if (isToday) cellClass += ' today';
            
            let eventsHtml = '';
            dayEvents.forEach(event => {
                eventsHtml += `<div class="event" onclick="editEvent(event, '${event.id}')">${event.startTime} ${event.title}</div>`;
            });
            
            return `
                <div class="${cellClass}" onclick="openModal('${formatDateForComparison(date)}')">
                    <div class="day-number">${date.getDate()}</div>
                    ${eventsHtml}
                </div>
            `;
        }

        function formatDateForComparison(date) {
            return date.toISOString().split('T')[0];
        }

        function previousMonth() {
            currentDate.setMonth(currentDate.getMonth() - 1);
            renderCalendar();
        }

        function nextMonth() {
            currentDate.setMonth(currentDate.getMonth() + 1);
            renderCalendar();
        }

        function currentMonth() {
            currentDate = new Date();
            renderCalendar();
        }

        function openModal(localDateStr) {
            document.getElementById('eventDate').value = localDateStr;
            document.getElementById('eventTitle').value = '';
            document.getElementById('eventStartTime').value = '';
            document.getElementById('eventEndTime').value = '';
            document.getElementById('modalTitle').textContent = 'Add Event';
            document.getElementById('deleteBtn').style.display = 'none';
            editingEventId = null;
            document.getElementById('eventModal').classList.add('active');
        }

        function editEvent(e, eventId) {
            e.stopPropagation();
            const event = events.find(ev => ev.id === eventId);
            if (event) {
                document.getElementById('eventTitle').value = event.title;
                document.getElementById('eventDate').value = event.date;
                document.getElementById('eventStartTime').value = event.startTime;
                document.getElementById('eventEndTime').value = event.endTime;
                document.getElementById('modalTitle').textContent = 'Edit Event';
                document.getElementById('deleteBtn').style.display = 'inline-block';
                editingEventId = eventId;
                document.getElementById('eventModal').classList.add('active');
            }
        }

        function closeModal() {
            document.getElementById('eventModal').classList.remove('active');
        }

        function saveEvent() {
            const title = document.getElementById('eventTitle').value;
            const date = document.getElementById('eventDate').value;
            const startTime = document.getElementById('eventStartTime').value;
            const endTime = document.getElementById('eventEndTime').value;
            
            if (!title || !date) {
                alert('Please fill in at least the title and date');
                return;
            }
            
            if (editingEventId) {
                // Update existing event
                const index = events.findIndex(e => e.id === editingEventId);
                if (index !== -1) {
                    events[index] = {
                        id: editingEventId,
                        title,
                        date,
                        startTime,
                        endTime
                    };
                }
            } else {
                // Add new event
                const event = {
                    id: Date.now().toString(),
                    title,
                    date,
                    startTime,
                    endTime
                };
                events.push(event);
            }
            
            localStorage.setItem('calendarEvents', JSON.stringify(events));
            renderCalendar();
            closeModal();
        }

        function deleteEvent() {
            if (editingEventId && confirm('Are you sure you want to delete this event?')) {
                events = events.filter(e => e.id !== editingEventId);
                localStorage.setItem('calendarEvents', JSON.stringify(events));
                renderCalendar();
                closeModal();
            }
        }

        function handleChatKeyPress(e) {
            if (e.key === 'Enter') {
                processChat();
            }
        }

        function processChat() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Add user message to chat
            addChatMessage(message, 'user');
            
            // Process the message
            const result = parseEventFromText(message);
            
            if (result.success) {
                // Add event
                const event = {
                    id: Date.now().toString(),
                    title: result.title,
                    date: result.date,
                    startTime: result.startTime,
                    endTime: result.endTime
                };
                events.push(event);
                localStorage.setItem('calendarEvents', JSON.stringify(events));
                renderCalendar();
                
                addChatMessage(`✅ Event "${result.title}" added for ${result.dateStr}${result.startTime ? ' at ' + result.startTime : ''}${result.endTime ? ' - ' + result.endTime : ''}`, 'ai');
            } else {
                addChatMessage("I couldn't understand that. Try something like 'Meeting tomorrow at 2pm' or 'Sept 10 2025 doctor appointment from 3 to 4pm'", 'ai');
            }
            
            input.value = '';
        }

        function addChatMessage(message, sender) {
            const messagesDiv = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}-message`;
            messageDiv.innerHTML = `<div class="bubble">${message}</div>`;
            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        function parseEventFromText(text) {
            const lowerText = text.toLowerCase();
            
            // Parse date with improved patterns
            let date = null;
            let dateStr = '';
            
            const monthNames = ['january', 'february', 'march', 'april', 'may', 'june', 
                               'july', 'august', 'september', 'october', 'november', 'december'];
            const shortMonthNames = ['jan', 'feb', 'mar', 'apr', 'may', 'jun', 
                                    'jul', 'aug', 'sept', 'sep', 'oct', 'nov', 'dec'];
            
            // Pattern: "12th of september" or "3rd of March" or "1st of January"
            let ordinalDateMatch = text.match(/(\d{1,2})(?:st|nd|rd|th)?\s+(?:of\s+)?(\w+)(?:\s+(\d{4}))?/i);
            if (ordinalDateMatch) {
                const day = parseInt(ordinalDateMatch[1]);
                const monthStr = ordinalDateMatch[2].toLowerCase();
                const year = ordinalDateMatch[3] ? parseInt(ordinalDateMatch[3]) : new Date().getFullYear();
                
                let month = shortMonthNames.findIndex(m => monthStr.startsWith(m));
                if (month === -1) month = monthNames.findIndex(m => monthStr.startsWith(m));
                
                if (month !== -1) {
                    date = new Date(year, month, day);
                    // If the date is in the past, assume next year
                    if (!ordinalDateMatch[3] && date < new Date()) {
                        date.setFullYear(year + 1);
                    }
                    dateStr = `${months[month]} ${day}, ${date.getFullYear()}`;
                }
            }
            
            // Pattern: "Sept 10 2025" or "September 10 2025" or "September 10"
            if (!date) {
                let dateMatch = text.match(/(\w+)\s+(\d{1,2})(?:\s+(\d{4}))?/i);
                if (dateMatch) {
                    const monthStr = dateMatch[1].toLowerCase();
                    const day = parseInt(dateMatch[2]);
                    const year = dateMatch[3] ? parseInt(dateMatch[3]) : new Date().getFullYear();
                    
                    let month = shortMonthNames.indexOf(monthStr);
                    if (month === -1) month = monthNames.indexOf(monthStr);
                    
                    if (month !== -1) {
                        date = new Date(year, month, day);
                        // If no year specified and date is in the past, assume next year
                        if (!dateMatch[3] && date < new Date()) {
                            date.setFullYear(year + 1);
                        }
                        dateStr = `${months[month]} ${day}, ${date.getFullYear()}`;
                    }
                }
            }
            
            // Handle relative dates
            if (!date) {
                if (lowerText.includes('tomorrow')) {
                    date = new Date();
                    date.setDate(date.getDate() + 1);
                    dateStr = 'Tomorrow';
                } else if (lowerText.includes('today')) {
                    date = new Date();
                    dateStr = 'Today';
                } else if (lowerText.includes('next')) {
                    const daysOfWeek = ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday'];
                    for (let dayName of daysOfWeek) {
                        if (lowerText.includes(dayName)) {
                            const today = new Date();
                            const todayDay = today.getDay();
                            const targetDay = daysOfWeek.indexOf(dayName);
                            let daysToAdd = targetDay - todayDay;
                            if (daysToAdd <= 0) daysToAdd += 7;
                            date = new Date();
                            date.setDate(date.getDate() + daysToAdd);
                            dateStr = `Next ${dayName.charAt(0).toUpperCase() + dayName.slice(1)}`;
                            break;
                        }
                    }
                }
            }
            
            // If still no date found, return error
            if (!date) {
                return { success: false };
            }
            
            // Parse time with more patterns
            let startTime = '';
            let endTime = '';
            
            // Pattern: "10:00 to 13:00" or "10am to 1pm"
            let timeRangeMatch = text.match(/(\d{1,2}:?\d{0,2}\s*(?:am|pm)?)\s+(?:to|-)\s+(\d{1,2}:?\d{0,2}\s*(?:am|pm)?)/i);
            if (timeRangeMatch) {
                startTime = formatTime(timeRangeMatch[1]);
                endTime = formatTime(timeRangeMatch[2]);
            } else {
                // Pattern: "at 2pm" or "at 14:00"
                let singleTimeMatch = text.match(/at\s+(\d{1,2}:?\d{0,2}\s*(?:am|pm)?)/i);
                if (singleTimeMatch) {
                    startTime = formatTime(singleTimeMatch[1]);
                }
            }
            
            // Extract and clean title using AI-like logic
            let title = extractEventTitle(text);
            
            return {
                success: true,
                title: title,
                date: formatDateForComparison(date),
                dateStr: dateStr,
                startTime: startTime,
                endTime: endTime
            };
        }

        function extractEventTitle(text) {
            // Keywords that indicate location, host, or event type
            const eventKeywords = {
                locations: ['in', 'at'],
                hosts: ['hosted by', 'organized by', 'by', 'with'],
                types: ['meeting', 'event', 'appointment', 'conference', 'workshop', 'webinar', 
                        'interview', 'presentation', 'class', 'lesson', 'seminar', 'call',
                        'careers', 'networking', 'training', 'session']
            };
            
            // Remove date patterns
            text = text.replace(/(\d{1,2})(st|nd|rd|th)?\s+of\s+\w+/gi, '');
            text = text.replace(/\w+\s+\d{1,2}(?:\s+\d{4})?/gi, '');
            text = text.replace(/tomorrow|today|next \w+/gi, '');
            
            // Remove time patterns
            text = text.replace(/\d{1,2}:?\d{0,2}\s*(?:am|pm)?\s+(?:to|-)\s+\d{1,2}:?\d{0,2}\s*(?:am|pm)?/gi, '');
            text = text.replace(/at\s+\d{1,2}:?\d{0,2}\s*(?:am|pm)?/gi, '');
            
            // Remove common filler phrases
            text = text.replace(/^\s*(i have|i've got|there's|there is|got)\s+(a|an|the)?\s*/i, '');
            text = text.replace(/[,\s]+$/, '');
            text = text.replace(/^[,\s]+/, '');
            
            // Extract key information
            let location = '';
            let host = '';
            let eventType = '';
            
            // Find location
            eventKeywords.locations.forEach(keyword => {
                const regex = new RegExp(`\\b${keyword}\\s+([A-Z][\\w\\s]+?)(?:,|\\.|$|hosted|organized|by|for)`, 'i');
                const match = text.match(regex);
                if (match && match[1]) {
                    location = match[1].trim();
                }
            });
            
            // Find host
            eventKeywords.hosts.forEach(keyword => {
                const regex = new RegExp(`${keyword}\\s+([\\w\\s]+?)(?:,|\\.|$|for)`, 'i');
                const match = text.match(regex);
                if (match && match[1]) {
                    host = match[1].trim();
                }
            });
            
            // Find event type
            eventKeywords.types.forEach(type => {
                if (text.toLowerCase().includes(type)) {
                    eventType = type.charAt(0).toUpperCase() + type.slice(1);
                }
            });
            
            // Build professional title
            let title = '';
            
            // Special handling for specific hosts/companies
            if (host.toLowerCase().includes('bright network')) {
                host = 'Bright Network';
            }
            
            // Construct title based on available information
            if (eventType && location && host) {
                // "Careers Event - Bright Network (London)"
                title = `${eventType} - ${host} (${location})`;
            } else if (eventType && host) {
                // "Careers Event - Bright Network"
                title = `${eventType} - ${host}`;
            } else if (eventType && location) {
                // "Meeting in London"
                title = `${eventType} in ${location}`;
            } else if (host && location) {
                // "Bright Network Event (London)"
                title = `${host} Event (${location})`;
            } else if (host) {
                // "Bright Network Event"
                title = `${host} Event`;
            } else if (eventType) {
                // "Careers Event"
                title = eventType;
            } else if (location) {
                // "Event in London"
                title = `Event in ${location}`;
            } else {
                // Fallback: clean up the text and use what's left
                text = text.trim();
                if (text.length > 50) {
                    // If too long, try to extract the most important part
                    text = text.substring(0, 50).trim() + '...';
                }
                title = text || 'New Event';
            }
            
            // Clean up the title
            title = title.replace(/\s+/g, ' ').trim();
            title = title.replace(/^[,.\s]+|[,.\s]+$/g, '');
            
            // Ensure first letter is capitalized
            if (title) {
                title = title.charAt(0).toUpperCase() + title.slice(1);
            }
            
            return title || 'New Event';
        }

        function formatTime(timeStr) {
            timeStr = timeStr.trim();
            
            // Handle 24-hour format (15:30 or 15)
            if (!timeStr.includes('am') && !timeStr.includes('pm')) {
                if (timeStr.includes(':')) {
                    return timeStr.padStart(5, '0');
                } else {
                    const hour = parseInt(timeStr);
                    return `${hour.toString().padStart(2, '0')}:00`;
                }
            }
            
            // Handle 12-hour format (3pm, 3:30pm)
            const isPM = timeStr.includes('pm');
            timeStr = timeStr.replace(/\s*(am|pm)/i, '');
            
            let hour, minute = 0;
            if (timeStr.includes(':')) {
                [hour, minute] = timeStr.split(':').map(n => parseInt(n));
            } else {
                hour = parseInt(timeStr);
            }
            
            if (isPM && hour !== 12) {
                hour += 12;
            } else if (!isPM && hour === 12) {
                hour = 0;
            }
            
            return `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
        }

        // Initialize the calendar
        init();
    </script>
</body>
</html>